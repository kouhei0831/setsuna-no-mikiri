# CLAUDE.md

このファイルはClaude Code (claude.ai/code) がこのリポジトリのコードを扱う際のガイダンスを提供します。

[English version here](./CLAUDE.md)

## 許可された操作

Claude Codeは以下の操作を実行する権限があります：

1. **Edit**: ファイル編集操作（容易に取り消し可能）
   - ファイル内容の変更
   - コードの追加、更新、削除
   - 設定ファイルの編集
   - ドキュメントの更新

2. **Bash(git commit:*)**: Git コミット操作
   - `git add` でファイルをステージング
   - `git commit` でコミット作成
   - `git push` でリモートリポジトリにプッシュ
   - `git status`, `git diff`, `git log` でリポジトリ状態確認

3. **Bash(npm run:*)**: NPM スクリプト実行
   - `npm run build` でプロジェクトビルド
   - `npm run test` でテスト実行
   - `npm run start` で開発サーバー起動
   - `npm run lint` でコードリント
   - package.jsonで定義されたその他のスクリプト

## プロジェクト概要

**刹那の見切り (Setsuna no Mikiri)** - DXCテクノロジーのファミリーデー2025イベント用の防御アクションミニゲーム。プレイヤーは素早い反射神経でDXCのIT資産を脅威から守ります。

- **バージョン**: 2.0.0
- **対象**: 3-8歳の子供たち（DXC従業員の子供）
- **技術スタック**: Phaser.js 3.70.0、JavaScript (ES Modules)、HTML5
- **言語**: 日本語（子供向けにふりがな付き）

## 一般的な開発コマンド

### 開発サーバーの起動
```bash
# オプション1: 標準http-server（ポート8080）
npm start

# オプション2: ESモジュール対応サーバー（ポート8001）- 推奨
node server-es.js
```

### ビルドとテスト
- **ビルド**: 未実装（`npm build`はプレースホルダー）
- **テスト**: 未実装（`npm test`はプレースホルダー）
- **リント/型チェック**: リントや型チェックは設定されていません

## 高レベルアーキテクチャ

### ゲームシーン構造
ゲームはPhaserのシーンシステムを使用し、3つの主要なシーンがあります：

1. **PreloadScene** (`src/main.js:7-61`): プログレスバー付きのアセット読み込みを処理
2. **MenuScene** (`src/main.js:64-158`): スタートボタンとバージョン表示のあるメインメニュー
3. **GameScene** (`src/main.js:161-910`): コアゲームプレイの実装

### アセット管理システム
- **SVGアセット**: UI要素と脅威が`assets/images/`に保存
- **PNGアセット**: キャラクタースプライトと背景が`assets/gen/images/`に保存
- **アセットジェネレーター**: プログラム的なアセット作成用の`src/utils/`内のユーティリティスクリプト：
  - `AssetGenerator.js`: アセット生成の基底クラス
  - `StaticAssetGenerator.js`: 静的UI要素を生成
  - `AudioAssetGenerator.js`: オーディオ生成のプレースホルダー

### ゲーム状態管理
ゲームはステージベースの進行システムを実装：
- **プレイヤーの状態**: normal、defending、damaged、victory、ko
- **IT資産の状態**: normal、damaged、ko、victory
- **脅威の状態**: normal、cutin、ko、victory
- **シグナルの状態**: normal、active、success、error

### 入力処理
- シングルボタンゲームプレイ（スペース、クリック、またはタップ）
- モバイルデバイス用のフルスクリーンタップエリア
- 入力タイミングウィンドウはステージの難易度により変化

### 主要ゲームメカニクス
1. **防御タイミング**: プレイヤーは脅威が接近した時の視覚的シグナルに反応する必要があります
2. **ヘルスシステム**: IT資産はゲームオーバーまでに2回のヒットを受けることができます
3. **ステージ進行**: 難易度が上昇する7つのステージ
4. **視覚的フィードバック**: カットインアニメーション、シールドエフェクト、状態遷移

## 重要な注意事項

### DXCブランディング
- プライマリカラー: #6B46C1（DXCパープル）
- すべてのUI要素はDXCテクノロジーブランドガイドラインに従う
- 日本語テキストは子供の読みやすさのためにふりがなを含む

### パフォーマンスの考慮事項
- 目標: すべてのデバイスで60 FPS
- レスポンシブデザイン: 320pxから1920pxの幅
- ブラウザサポート: Chrome 80+、Safari 13+、Firefox 75+

### 現在の実装状況
- ✅ メニューとローディング画面
- ✅ 7ステージの基本ゲームループ
- ✅ プレイヤーと脅威のアニメーション
- ✅ 勝利とゲームオーバー画面
- ✅ パフォーマンス監視用のフレームカウンター
- ❌ 効果音とBGM
- ❌ ビルドプロセス
- ❌ テストスイート

### 開発のヒント
1. ゲームはバンドルなしでブラウザで直接実行 - 変更を見るには更新するだけ
2. 適切なESモジュールサポートのために`server-es.js`を使用
3. 詳細なフレームタイミングとパフォーマンスメトリクスのためにブラウザコンソールを確認
4. アセット生成スクリプトは新しいグラフィックスを作成するために独立して実行可能

### ファイル構造の規約
- ゲームロジック: すべて`src/main.js`内（シンプルさのために単一ファイル）
- アセット: SVGは`assets/images/`、PNGは`assets/gen/images/`
- ドキュメント: 設計文書は`docs/`
- ビルド成果物やnode_modulesはバージョン管理に含めない